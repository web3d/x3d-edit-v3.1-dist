<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<!--Generated using XSLT processor: SAXON 8.7 from Saxonica--><html xmlns="http://www.w3.org/TR/xhtml1/strict">
   <head>
      <title>IntegerSequencerPrototype.x3d (X3dToXhtml)</title>
      <style type="text/css">
span.element {color: navy}
span.attribute {color: green}
span.value {color: teal}
span.plain {color: black}
span.gray  {color: gray}
span.prototype {color: purple}
a.prototype {color: purple, visited: black}
span.route {color: red}
span.nodeName {color: maroon}
a.nodeName {color: maroon}
div.center {text-align: center}
div.indent {margin-left: 25px}
b.warning {color: #CC5500}
b.error {color: #CC0000}
	</style>
      <meta name="generator" content="http://www.web3d.org/x3d/content/X3dToXhtml.xslt"/>
      <link rel="shortcut icon"
            href="http://www.web3d.org/x3d/content/icons/X3DtextIcon16.png"
            title="X3D"/>
   </head>
   <body>
      <pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D 3.0//EN"   "http://www.web3d.org/specifications/x3d-3.0.dtd"&gt;</pre>

&lt;<span class="element">X3D</span>&#160;<span class="attribute">version</span>='<span class="value">3.0</span>'&#160;<span class="attribute">profile</span>='<span class="value">Immersive</span>'&#160;<span class="attribute">xmlns:xsd</span>='<a href="http://www.w3.org/2001/XMLSchema-instance" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>' <span class="attribute">xsd:noNamespaceSchemaLocation</span>='
<a href="http://www.web3d.org/specifications/x3d-3.0.xsd">http://www.web3d.org/specifications/x3d-3.0.xsd</a> '&gt;
<div class="indent">
&lt;<span class="element">head</span>&gt;
<div class="indent">
&lt;<span class="element">meta</span>&#160;<span class="attribute">name</span>='<span class="value">title</span>'&#160;<span class="attribute">content</span>='<a href="IntegerSequencerPrototype.x3d" target="_blank">IntegerSequencerPrototype.x3d</a>'/&gt;
<br />
&lt;<span class="element">meta</span>&#160;<span class="attribute">name</span>='<span class="value">description</span>'&#160;<span class="attribute">content</span>='<span class="plain">This proto, modeled after a ScalarInterpolator, generates an array of integer values based on the input fraction and keys.</span>'/&gt;
<br />
&lt;<span class="element">meta</span>&#160;<span class="attribute">name</span>='<b class="warning">warning</b>'&#160;<span class="attribute">content</span>='<b class="warning">MFInt32 keyValue accessType is listed as initializeOnly/field, since inputOutput cannot be translated to exposedField in VRML97 scripting.</b>'/&gt;
<br />
&lt;<span class="element">meta</span>&#160;<span class="attribute">name</span>='<span class="value">authors</span>'&#160;<span class="attribute">content</span>='<span class="value">Don Brutzman, Estuko Lippi, Jeff Weekley, Jane Wu, Matthew Braun</span>'/&gt;
<br />
&lt;<span class="element">meta</span>&#160;<span class="attribute">name</span>='<span class="value">created</span>'&#160;<span class="attribute">content</span>='<span class="value">20 August 2001</span>'/&gt;
<br />
&lt;<span class="element">meta</span>&#160;<span class="attribute">name</span>='<span class="value">modified</span>'&#160;<span class="attribute">content</span>='<span class="value">25 December 2005</span>'/&gt;
<br />
&lt;<span class="element">meta</span>&#160;<span class="attribute">name</span>='<span class="value">reference</span>'&#160;<span class="attribute">content</span>='
<a href="http://www.web3d.org/technicalinfo/specifications/vrml97/part1/nodesRef.html#ScalarInterpolator">http://www.web3d.org/technicalinfo/specifications/vrml97/part1/nodesRef.html#ScalarInterpolator</a> '/&gt;
<br />
&lt;<span class="element">meta</span>&#160;<span class="attribute">name</span>='<span class="value">subject</span>'&#160;<span class="attribute">content</span>='<span class="value">integer sequencer</span>'/&gt;
<br />
&lt;<span class="element">meta</span>&#160;<span class="attribute">name</span>='<span class="value">identifier</span>'&#160;<span class="attribute">content</span>='
<a href="http://www.web3d.org/x3d/content/examples/Basic/development/IntegerSequencerPrototype.x3d">http://www.web3d.org/x3d/content/examples/Basic/development/IntegerSequencerPrototype.x3d</a> '/&gt;
<br />
&lt;<span class="element">meta</span>&#160;<span class="attribute">name</span>='<span class="value">generator</span>'&#160;<span class="attribute">content</span>='<span class="value">X3D-Edit, </span>
            <a href="http://www.web3d.org/x3d/content/README.X3D-Edit.html" target="_blank">http://www.web3d.org/x3d/content/README.X3D-Edit.html</a>'/&gt;
<br />
&lt;<span class="element">meta</span>&#160;<span class="attribute">name</span>='<span class="value">license</span>'&#160;<span class="attribute">content</span>='<a href="../../license.html" target="_blank">../../license.html</a>'/&gt;
</div>&lt;/<span class="element">head</span>&gt;
<br />
&lt;!--
<div class="center">
            <hr width="100%"/>
            <i>Index for ProtoDeclare definition</i>: 
<a href="#ProtoDeclare_IntegerSequencer" class="prototype">IntegerSequencer</a>
<br />
<i>Index for DEF nodes</i>: 
<a href="#KeyHolder" class="nodeName">KeyHolder</a>,
<a href="#SequencerScript" class="nodeName">SequencerScript</a>
            <hr width="100%"/>
         </div>
--&gt;
<br />
&lt;<span class="element">Scene</span>&gt;
<div class="indent">
            <a name="ProtoDeclare_IntegerSequencer"> </a> 
&lt;<span class="prototype">ProtoDeclare</span>&#160;<span class="attribute">name</span>='<span class="prototype">IntegerSequencer</span>'&gt;
<div class="indent">
&lt;<span class="prototype">ProtoInterface</span>&gt;
<div class="indent">&lt;!-- Regular interpolator-style input --&gt;
<br /><a name="IntegerSequencerProtoField_set_fraction"> </a> 
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">set_fraction</span>'&#160;<span class="attribute">type</span>='<span class="value">SFFloat</span>'&#160;<span class="attribute">accessType</span>='<span class="value">inputOnly</span>'
<br />
&#160;<span class="gray">appinfo</span>='<span class="gray">range [0..1]</span>'/&gt;
<br /><a name="IntegerSequencerProtoField_set_key"> </a> 
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">set_key</span>'&#160;<span class="attribute">type</span>='<span class="value">MFFloat</span>'&#160;<span class="attribute">accessType</span>='<span class="value">inputOnly</span>'
<br />
&#160;<span class="gray">appinfo</span>='<span class="gray">Array sequentially increasing, typically [0..1].  Must have the same number of keys as keyValues.</span>'/&gt;
<br /><a name="IntegerSequencerProtoField_key"> </a> 
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">key</span>'&#160;<span class="attribute">type</span>='<span class="value">MFFloat</span>'&#160;<span class="attribute">accessType</span>='<span class="value">inputOutput</span>'
<br />
&#160;<span class="gray">appinfo</span>='<span class="gray">Array sequentially increasing, typically [0..1].  Must have the same number of keys as keyValues.</span>'/&gt;
<br /><a name="IntegerSequencerProtoField_key_changed"> </a> 
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">key_changed</span>'&#160;<span class="attribute">type</span>='<span class="value">MFFloat</span>'&#160;<span class="attribute">accessType</span>='<span class="value">outputOnly</span>'
<br />
&#160;<span class="gray">appinfo</span>='<span class="gray">Array sequentially increasing, typically [0..1].  Must have the same number of keys as keyValues.</span>'/&gt;
<br /><a name="IntegerSequencerProtoField_set_keyValue"> </a> 
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">set_keyValue</span>'&#160;<span class="attribute">type</span>='<span class="value">MFInt32</span>'&#160;<span class="attribute">accessType</span>='<span class="value">inputOnly</span>'
<br />
&#160;<span class="gray">appinfo</span>='<span class="gray">Array of integer values.  Must have the same number of keys as keyValues.</span>'/&gt;
<br /><a name="IntegerSequencerProtoField_keyValue"> </a> 
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">keyValue</span>'&#160;<span class="attribute">type</span>='<span class="value">MFInt32</span>'&#160;<span class="attribute">accessType</span>='<span class="value">initializeOnly</span>'
<br />
&#160;<span class="gray">appinfo</span>='<span class="gray">Array of integer values.  Must have the same number of keys as keyValues.</span>'/&gt;
<br /><a name="IntegerSequencerProtoField_keyValue_changed"> </a> 
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">keyValue_changed</span>'&#160;<span class="attribute">type</span>='<span class="value">MFInt32</span>'&#160;<span class="attribute">accessType</span>='<span class="value">outputOnly</span>'
<br />
&#160;<span class="gray">appinfo</span>='<span class="gray">Array of integer values.  Must have the same number of keys as keyValues.</span>'/&gt;
<br />&lt;!-- Regular interpolator-style output --&gt;
<br /><a name="IntegerSequencerProtoField_value_changed"> </a> 
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">value_changed</span>'&#160;<span class="attribute">type</span>='<span class="value">SFInt32</span>'&#160;<span class="attribute">accessType</span>='<span class="value">outputOnly</span>'/&gt;
<br />&lt;!-- Utility methods --&gt;
<br /><a name="IntegerSequencerProtoField_previous"> </a> 
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">previous</span>'&#160;<span class="attribute">type</span>='<span class="value">SFBool</span>'&#160;<span class="attribute">accessType</span>='<span class="value">inputOnly</span>'/&gt;
<br /><a name="IntegerSequencerProtoField_next"> </a> 
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">next</span>'&#160;<span class="attribute">type</span>='<span class="value">SFBool</span>'&#160;<span class="attribute">accessType</span>='<span class="value">inputOnly</span>'/&gt;
</div>&lt;/<span class="prototype">ProtoInterface</span>&gt;
<br />
&lt;<span class="prototype">ProtoBody</span>&gt;
<div class="indent">
&lt;<span class="element">Group</span>&gt;
<div class="indent">
&lt;<span class="element">Switch</span>&#160;<span class="attribute">whichChoice</span>='<span class="value">-1</span>'&gt;
<div class="indent">
                        <a name="KeyHolder"> </a> 
&lt;<span class="element">ScalarInterpolator</span>&#160;<span class="attribute">DEF</span>='<span class="nodeName">KeyHolder</span>'&gt;
<div class="indent">
&lt;<span class="element">IS</span>&gt;
<div class="indent">
&lt;<span class="element">connect</span>&#160;<span class="attribute">nodeField</span>='<span class="prototype">key</span>'&#160;<span class="attribute">protoField</span>='<span class="prototype"><a href="#IntegerSequencerProtoField_key" class="prototype">key</a></span>'/&gt;
</div>&lt;/<span class="element">IS</span>&gt;
</div>&lt;/<span class="element">ScalarInterpolator</span>&gt;
</div>&lt;/<span class="element">Switch</span>&gt;
<br /><a name="SequencerScript"> </a> 
&lt;<span class="element">Script</span>&#160;<span class="attribute">DEF</span>='<span class="nodeName">SequencerScript</span>'&#160;<span class="attribute">directOutput</span>='<span class="value">true</span>'&gt;
<div class="indent">&lt;!-- Regular interpolator-style input --&gt;
<br />
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">set_fraction</span>'&#160;<span class="attribute">type</span>='<span class="value">SFFloat</span>'&#160;<span class="attribute">accessType</span>='<span class="value">inputOnly</span>'
<br />
&#160;<span class="gray">appinfo</span>='<span class="gray">range [0..1]</span>'/&gt;
<br />
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">set_key</span>'&#160;<span class="attribute">type</span>='<span class="value">MFFloat</span>'&#160;<span class="attribute">accessType</span>='<span class="value">inputOnly</span>'
<br />
&#160;<span class="gray">appinfo</span>='<span class="gray">Array sequentially increasing [0..1].  Must have the same number of keys as keyValues.</span>'/&gt;
<br />
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">keyHolderNode</span>'&#160;<span class="attribute">type</span>='<span class="value">SFNode</span>'&#160;<span class="attribute">accessType</span>='<span class="value">initializeOnly</span>'&gt;
<div class="indent">
&lt;<span class="element">ScalarInterpolator</span>&#160;<span class="attribute">USE</span>='<a href="#KeyHolder" class="nodeName">KeyHolder</a>'/&gt;
</div>&lt;/<span class="prototype">field</span>&gt;
<br />
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">key_changed</span>'&#160;<span class="attribute">type</span>='<span class="value">MFFloat</span>'&#160;<span class="attribute">accessType</span>='<span class="value">outputOnly</span>'
<br />
&#160;<span class="gray">appinfo</span>='<span class="gray">Array sequentially increasing [0..1].  Must have the same number of keys as keyValues.</span>'/&gt;
<br />
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">set_keyValue</span>'&#160;<span class="attribute">type</span>='<span class="value">MFInt32</span>'&#160;<span class="attribute">accessType</span>='<span class="value">inputOnly</span>'
<br />
&#160;<span class="gray">appinfo</span>='<span class="gray">Array of integer values.  Must have the same number of keys as keyValues.</span>'/&gt;
<br />
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">keyValue</span>'&#160;<span class="attribute">type</span>='<span class="value">MFInt32</span>'&#160;<span class="attribute">accessType</span>='<span class="value">initializeOnly</span>'/&gt;
<br />
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">keyValue_changed</span>'&#160;<span class="attribute">type</span>='<span class="value">MFInt32</span>'&#160;<span class="attribute">accessType</span>='<span class="value">outputOnly</span>'
<br />
&#160;<span class="gray">appinfo</span>='<span class="gray">Array of integer values.  Must have the same number of keys as keyValues.</span>'/&gt;
<br />&lt;!-- Regular interpolator-style output --&gt;
<br />
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">value_changed</span>'&#160;<span class="attribute">type</span>='<span class="value">SFInt32</span>'&#160;<span class="attribute">accessType</span>='<span class="value">outputOnly</span>'/&gt;
<br />&lt;!-- Utility methods --&gt;
<br />
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">previous</span>'&#160;<span class="attribute">type</span>='<span class="value">SFBool</span>'&#160;<span class="attribute">accessType</span>='<span class="value">inputOnly</span>'/&gt;
<br />
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">next</span>'&#160;<span class="attribute">type</span>='<span class="value">SFBool</span>'&#160;<span class="attribute">accessType</span>='<span class="value">inputOnly</span>'/&gt;
<br />
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">traceEnabled</span>'&#160;<span class="attribute">type</span>='<span class="value">SFBool</span>'&#160;<span class="attribute">accessType</span>='<span class="value">initializeOnly</span>'
<br />
&#160;<span class="gray">appinfo</span>='<span class="gray">For development use only, not for inclusion in specification implementations.</span>'/&gt;
<br />&lt;!-- Script-specific interfaces, not needed for node definition --&gt;
<br />
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">previousFraction</span>'&#160;<span class="attribute">type</span>='<span class="value">SFFloat</span>'&#160;<span class="attribute">value</span>='<span class="value">0.0</span>'&#160;<span class="attribute">accessType</span>='<span class="value">initializeOnly</span>'/&gt;
<br />
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">nextIndex</span>'&#160;<span class="attribute">type</span>='<span class="value">SFInt32</span>'&#160;<span class="attribute">value</span>='<span class="value">0</span>'&#160;<span class="attribute">accessType</span>='<span class="value">initializeOnly</span>'/&gt;
<br />
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">valid</span>'&#160;<span class="attribute">type</span>='<span class="value">SFBool</span>'&#160;<span class="attribute">value</span>='<span class="value">true</span>'&#160;<span class="attribute">accessType</span>='<span class="value">initializeOnly</span>'/&gt;
<br />
&lt;<span class="prototype">field</span>&#160;<span class="attribute">name</span>='<span class="prototype">recheckValidity</span>'&#160;<span class="attribute">type</span>='<span class="value">SFBool</span>'&#160;<span class="attribute">value</span>='<span class="value">false</span>'&#160;<span class="attribute">accessType</span>='<span class="value">initializeOnly</span>'/&gt;
<br />
&lt;<span class="element">IS</span>&gt;
<div class="indent">
&lt;<span class="element">connect</span>&#160;<span class="attribute">nodeField</span>='<span class="prototype">set_fraction</span>'&#160;<span class="attribute">protoField</span>='<span class="prototype"><a href="#IntegerSequencerProtoField_set_fraction" class="prototype">set_fraction</a></span>'/&gt;
<br />
&lt;<span class="element">connect</span>&#160;<span class="attribute">nodeField</span>='<span class="prototype">set_key</span>'&#160;<span class="attribute">protoField</span>='<span class="prototype"><a href="#IntegerSequencerProtoField_set_key" class="prototype">set_key</a></span>'/&gt;
<br />
&lt;<span class="element">connect</span>&#160;<span class="attribute">nodeField</span>='<span class="prototype">key_changed</span>'&#160;<span class="attribute">protoField</span>='<span class="prototype"><a href="#IntegerSequencerProtoField_key_changed" class="prototype">key_changed</a></span>'/&gt;
<br />
&lt;<span class="element">connect</span>&#160;<span class="attribute">nodeField</span>='<span class="prototype">set_keyValue</span>'&#160;<span class="attribute">protoField</span>='<span class="prototype"><a href="#IntegerSequencerProtoField_set_keyValue" class="prototype">set_keyValue</a></span>'/&gt;
<br />
&lt;<span class="element">connect</span>&#160;<span class="attribute">nodeField</span>='<span class="prototype">keyValue</span>'&#160;<span class="attribute">protoField</span>='<span class="prototype"><a href="#IntegerSequencerProtoField_keyValue" class="prototype">keyValue</a></span>'/&gt;
<br />
&lt;<span class="element">connect</span>&#160;<span class="attribute">nodeField</span>='<span class="prototype">keyValue_changed</span>'&#160;<span class="attribute">protoField</span>='<span class="prototype"><a href="#IntegerSequencerProtoField_keyValue_changed" class="prototype">keyValue_changed</a></span>'/&gt;
<br />
&lt;<span class="element">connect</span>&#160;<span class="attribute">nodeField</span>='<span class="prototype">value_changed</span>'&#160;<span class="attribute">protoField</span>='<span class="prototype"><a href="#IntegerSequencerProtoField_value_changed" class="prototype">value_changed</a></span>'/&gt;
<br />
&lt;<span class="element">connect</span>&#160;<span class="attribute">nodeField</span>='<span class="prototype">previous</span>'&#160;<span class="attribute">protoField</span>='<span class="prototype"><a href="#IntegerSequencerProtoField_previous" class="prototype">previous</a></span>'/&gt;
<br />
&lt;<span class="element">connect</span>&#160;<span class="attribute">nodeField</span>='<span class="prototype">next</span>'&#160;<span class="attribute">protoField</span>='<span class="prototype"><a href="#IntegerSequencerProtoField_next" class="prototype">next</a></span>'/&gt;
</div>&lt;/<span class="element">IS</span>&gt;
<br />
</div class="indent">
</div class="indent">
</div class="indent">
</div class="indent">
</div class="indent">
<code>
                           <b>&lt;![CDATA[</b>
                        </code>
                        <pre>
            ecmascript:

var leftToRight;

function initialize(timeStamp)
{
	key      = keyHolderNode.key;
	tracePrint('Initializing a new IntegerSequencer.  key.length=' + key.length + '; keyValue.length=' + keyValue.length);
	tracePrint('key = ' + key);
	tracePrint('keyValue = ' + keyValue);

	validityCheck();
	setHalfKeyRange();

	// assume we start at first key, going left to right
	leftToRight = true;
	previousFraction = key[0];
	nextIndex = 1;  //validityCheck ensures minimum of 2 keys exist
}

function set_fraction(newFraction, timeStamp)
{
	if (recheckValidity) validityCheck();

	if (!valid) return; //IntegerSequencer ignored

	//Bounds checking
	if (newFraction &lt; key[0])
	{
		tracePrint('*** warning: fraction is less than first key.  fraction set to first key ***');
		newFraction = key[0];
	}
	else if (newFraction &gt; key[key.length-1])
	{
		tracePrint('*** warning: fraction is greater than last key.  fraction set to last key ***');
		newFraction = key[key.length -1];
	}

	//Check animation direction
	if (newFraction &lt; previousFraction &amp;&amp; leftToRight == true)
	{
		if ((previousFraction - newFraction) &gt; halfKeyRange) //looped around
		{
			nextIndex = 1;
		}
		else //just changed direction
		{
			leftToRight = false;
			nextIndex = nextIndex - 1;
            }
	}
	else if (newFraction &gt; previousFraction &amp;&amp; leftToRight == false)
	{
		if ((newFraction - previousFraction) &lt; halfKeyRange) //looped around
		{
			nextIndex = key.length - 2;
		}
		else //just changed direction
		{
			leftToRight = true;
			nextIndex = nextIndex + 1;
            }
	}
	else if (newFraction == previousFraction)
	{ //no change, so no processing required
		return;
	}
	previousFraction = newFraction;

	if (leftToRight) // moving left to right
	{
		while (newFraction &gt; key[nextIndex]) nextIndex++;

		if (newFraction == key[nextIndex])
			value_changed = keyValue[nextIndex];
		else	value_changed = keyValue[nextIndex -1];

		tracePrint('forward animation, fraction = ' + newFraction);
		tracePrint('value_changed eventOut is: ' + value_changed);
	}
	else // moving right to left
	{
		while (newFraction &lt; key[nextIndex]) nextIndex--;

		if (newFraction == key[nextIndex])
			value_changed = keyValue[nextIndex];
		else	value_changed = keyValue[nextIndex + 1];

		tracePrint('backward animation, fraction = ' + newFraction);
		tracePrint('value_changed eventOut is: ' + value_changed);
	}
}

function set_key(newKey, timeStamp)
{
	key = newKey;
	keyHolderNode.key = newKey;
	setHalfKeyWidth();
	recheckValidity = true;
}

function set_keyValue(newKeyValue, timeStamp)
{
	keyValue = newKeyValue;
	recheckValidity = true;
}

function setHalfKeyRange()
{
	halfKeyRange = (key[key.length - 1] - key[0])/2.0;
}

function previous (value, timeStamp)
{
  if (value==true) // trigger on true events only
  {
	leftToRight = true;
	nextIndex = nextIndex - 2; // reset to previous
	if (nextIndex &lt; 0) nextIndex = nextIndex + key.length;
	value_changed = keyValue[nextIndex];
	previousFraction = key[nextIndex];
	nextIndex++; // setup for next time, leftToRight
	if (nextIndex &gt; key.length - 1) nextIndex = 0;
  }
}
function next (value, timeStamp)
{
  if (value==true) // trigger on true events only
  {
	leftToRight = true;
	value_changed = keyValue[nextIndex];
	previousFraction = key[nextIndex];
	nextIndex++; // setup for next time,leftToRight
	if (nextIndex &gt; key.length - 1) nextIndex = 0;
  }
}

function validityCheck()
{
	//Check if lengths of key &amp; keyValue arrays match
	if (key.length != keyValue.length)
	{
		forcePrint('*** error: key and keyValue arrays must be of the same length.  IntegerSequencer ignored ***');
		valid = false;
		return;
	}
	//check to ensure minimum of 2 keys have been specified
	if (key.length &lt; 2)
	{
		forcePrint('*** error: must contain at least 2 keys.  IntegerSequencer ignored ***');
		valid = false;
		return;
	}

	//Check if key array has values in an non-decreasing order
	for (i = 1; i &lt; key.length; i++)
	{
		tracePrint('i= ' + i);

		if (key[i] &lt; key [i-1])
		{
			forcePrint('*** error: key array values must be listed in a non-decreasing order.  IntegerSequencer ignored ***');
			valid = false;
			return;
		}
	}
	valid = true
	recheckValidity = false;
	key_changed = key;
	keyValue_changed = keyValue;
	return;
}

function tracePrint(outputString)
{
	if (traceEnabled) Browser.print ('[IntegerSequencer] ' + outputString);
}

function forcePrint(outputString)
{
	Browser.print ('[IntegerSequencer] ' + outputString);
}
          </pre>
                        <code>
                           <b>]]&gt;</b>
                        </code>
<div class="indent">
<div class="indent">
<div class="indent">
<div class="indent">
<div class="indent">
</div>&lt;/<span class="element">Script</span>&gt;
</div>&lt;/<span class="element">Group</span>&gt;
</div>&lt;/<span class="prototype">ProtoBody</span>&gt;
</div>&lt;/<span class="prototype">ProtoDeclare</span>&gt;
<br />&lt;!-- ===============Example============== --&gt;
<br />
&lt;<span class="element">Anchor</span>&#160;<span class="attribute">description</span>='<span class="value">IntegerSequencerExample</span>'&#160;<span class="attribute">parameter</span>='<span class="value">target=_blank</span>'
<br />
&#160;&#160;<span class="attribute">url</span>='
"<a href="IntegerSequencerExample.wrl">IntegerSequencerExample.wrl</a>"
"<a href="https://savage.nps.edu/Savage/Tools/Animation/IntegerSequencerExample.wrl">https://savage.nps.edu/Savage/Tools/Animation/IntegerSequencerExample.wrl</a>"
"<a href="IntegerSequencerExample.x3d">IntegerSequencerExample.x3d</a>"
"<a href="https://savage.nps.edu/Savage/Tools/Animation/IntegerSequencerExample.x3d">https://savage.nps.edu/Savage/Tools/Animation/IntegerSequencerExample.x3d</a>"
'&gt;
<div class="indent">
&lt;<span class="element">Shape</span>&gt;
<div class="indent">
&lt;<span class="element">Text</span>&#160;<span class="attribute">string</span>='<span class="value">"IntegerSequencerPrototype" 
"defines a prototype" 
""
"Click text to see example scene"
"IntegerSequencerExample"</span>'&#160;<span class="attribute">solid</span>='<span class="value">true</span>'&gt;
<div class="indent">
&lt;<span class="element">FontStyle</span>&#160;<span class="attribute">justify</span>='<span class="value">"MIDDLE" "MIDDLE"</span>'&#160;<span class="attribute">size</span>='<span class="value">0.9</span>'/&gt;
</div>&lt;/<span class="element">Text</span>&gt;
<br />
&lt;<span class="element">Appearance</span>&gt;
<div class="indent">
&lt;<span class="element">Material</span>&#160;<span class="attribute">diffuseColor</span>='<span class="value">1 1 0.2</span>'/&gt;
</div>&lt;/<span class="element">Appearance</span>&gt;
</div>&lt;/<span class="element">Shape</span>&gt;
</div>&lt;/<span class="element">Anchor</span>&gt;
</div>&lt;/<span class="element">Scene</span>&gt;
</div>&lt;/<span class="element">X3D</span>&gt;
<br />
&lt;!--
<div class="center">
         <hr width="100%"/>
         <i>Index for ProtoDeclare definition</i>: 
<a href="#ProtoDeclare_IntegerSequencer" class="prototype">IntegerSequencer</a>
<br />
<i>Index for DEF nodes</i>: 
<a href="#KeyHolder" class="nodeName">KeyHolder</a>,
<a href="#SequencerScript" class="nodeName">SequencerScript</a>
         <hr width="100%"/>
      </div>
--&gt;
<p>
&lt;!-- Tag color codes:
&lt;<span class="element">Node</span>
         <span class="nodeName"> DEF</span>='<span class="nodeName">NodeName</span>' <span class="attribute">attribute</span>='<span class="value">value</span>'/&gt;
&lt;<span class="prototype">Prototype</span> 
         <span class="attribute">name</span>='<span class="prototype">ProtoName</span>'&gt;
	&lt;<span class="prototype">field</span>
         <span class="attribute">name</span>='<span class="prototype">fieldName</span>'/&gt; &lt;/<span class="prototype">Prototype</span>&gt; --&gt;
</p>
   </body>
</html>